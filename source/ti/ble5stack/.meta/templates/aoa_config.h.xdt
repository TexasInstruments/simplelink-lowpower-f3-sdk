/*
 *  ======== ti_aoa_config.h ========
 *  Configured AoA module definitions
 *
 *  DO NOT EDIT - This file is generated by the SysConfig tool.
 */

#ifndef TI_AOA_CONFIG_H
#define TI_AOA_CONFIG_H
%%{
/*
 *  ======== ti_aoa_config.h.xdt ========
 */

// Get the aoa module
const aoa = system.modules["/ti/ble5stack/aoa/aoa"].$static;
%%}

%%{
const antObj = aoa.antTbl.ant;

let numOfAnt = antObj.length;
let antTable = new Array(numOfAnt);
let antMaskArray = [];
let antMask = "";
let antTblMask = new Array(numOfAnt).fill("");

for (let antIndex=0; antIndex < numOfAnt; antIndex++)
{
    antTable[antIndex] = [];
    for (let dioIndex=0; dioIndex < antObj[antIndex].dio.length; dioIndex++)
    {
        if (antObj[antIndex].dio[dioIndex].dio >= 0)
        {
            if (antMaskArray.indexOf(antObj[antIndex].dio[dioIndex].dio) == -1)
            {
                antMaskArray.push(antObj[antIndex].dio[dioIndex].dio);
            }
            if (antTable[antIndex].indexOf(antObj[antIndex].dio[dioIndex].dio) == -1)
            {
                antTable[antIndex].push(antObj[antIndex].dio[dioIndex].dio);
            }
       }
   }

   // Generate antenna mask for antenna table
   if(antTable[antIndex].length == 0)
   {
        antTblMask[antIndex] += '\n';
        antTblMask[antIndex] += "0"
   }
   else
   {
        antTable[antIndex].sort((a, b) => a - b);
        antTblMask[antIndex] += '\n';
        for (let antTblIndex=0; antTblIndex<antTable[antIndex].length; antTblIndex++)
        {
            if (antTblIndex != 0)
            {
                antTblMask[antIndex] += " | ";
            }
            antTblMask[antIndex] += "BV(" + antTable[antIndex][antTblIndex] + ")";
        }
   }
}

// Genrate antenna mask from enabled DIOs
antMaskArray.sort((a, b) => a - b);
for (let antMaskIndex=0; antMaskIndex<antMaskArray.length; antMaskIndex++)
{
    if (antMaskIndex != 0)
    {
        antMask += " | ";
    }
    antMask += "BV(" + antMaskArray[antMaskIndex] + ")";
}
%%}

// Maximum number of antennas
#define ANTENNA_TABLE_SIZE `numOfAnt`

// BitMask of all the relevant DIOs which needed for the antennas
#define ANTENNA_IO_MASK `antMask`

// Antenna DIO configuration (should be adapted to the antenna board design)
uint32 antennaTbl[] = {`antTblMask`
};

#endif // TI_AOA_CONFIG_H
